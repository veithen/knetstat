name: Continuous Integration

on:
  push:
    branches: [ '*' ]
  pull_request:
    branches: [ '*' ]

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        kernel:
        - '4.4.260'
        - '4.9.260'
        - '4.14.224'
        - '4.19.179'
        - '5.4.104'
        - '5.10.22'
        - '5.11.6'
        - '5.16'
        - '5.17'
        - '6.0'
        - '6.1'
        - '6.6'
        - '6.7'
    name: "Linux ${{ matrix.kernel }}"
    runs-on: ubuntu-22.04
    steps:
    - name: Checkout
      uses: actions/checkout@v5
    - name: Install dependencies
      run: sudo apt-get install libelf-dev
    - name: Download kernel sources
      run: curl https://cdn.kernel.org/pub/linux/kernel/$(echo ${{ matrix.kernel }} | sed -E 's/([^.]+)[.].*/v\1.x/')/linux-${{ matrix.kernel }}.tar.xz | tar xJ
    - name: Configure kernel sources
      run: |
        make -C linux-${{ matrix.kernel }} defconfig
    - name: Build the kernel
      run: |
        make -j6 -C linux-${{ matrix.kernel }}
    - name: Build the module
      run: |
        make KSRC=linux-${{ matrix.kernel }}
